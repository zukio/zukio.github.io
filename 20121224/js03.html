<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <h1>deviceOrientation | GPSのテスト</h1>
  <ul>
    <li></li>
    <li></li>
    <li></li>
  </ul>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
$(function(){
  console.log('読み込んだよ');
  //GPSからの緯度経度の取得
  navigator.geolocation.getCurrentPosition(function(pos){
    console.log(pos);
    var lat = calLocation(pos.coords.latitude); //緯度
    var lon = calLocation(pos.coords.longitude); //経度
    setWeather(lat,lon); //緯度経度を受け渡し
    console.log('lat: '+lat, 'lon: '+lon)
  });

  //天気を表示する関数
  function setWeather(lat, lon){
    //openweathermapのAPIキー（定数：const）
    const apikey = '8a3117bdb78b8f0efa0fc11d5a710e92';
    //openweathermapのURL
    var weatherUrl = 'http://api.openweathermap.org/data/2.5/weather?lat='+lat+'&lon='+lon+'&appid='+apikey;
    //ajax通信
    $.ajax({
      url:weatherUrl,
      dataType:'json'
    }).done(function(data){

    }).fail(function(){
      consoke.log('ajax error');
    });
  }

  //小数点2桁で切り捨て
  function calLocation(num){
    var numA = num*100;
    numA = Math.floor(numA)/100;
    return numA;
  }

});
</script>
</body>
</html>
